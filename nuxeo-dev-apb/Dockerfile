FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBudXhlby1kZXYtYXBiCmRlc2NyaXB0aW9uOiBOdXhlbyBE\
ZXYgZW52aXJvbm1lbnQgd2l0aCBDSS9DRApiaW5kYWJsZTogZmFsc2UKYXN5bmM6IG9wdGlvbmFs\
CnRhZ3M6CiAgLSBudXhlbwptZXRhZGF0YToKICBkaXNwbGF5TmFtZTogTnV4ZW8gRGV2IGVudmly\
b25tZW50CiAgbG9uZ0Rlc2NyaXB0aW9uOgogICAgQSBmdWxsIGFuZCBtb2R1bGFyIE51eGVvIGRl\
dmVsb3BtZW50IGVudmlyb25tZW50IHRoYXQgYWxsb3dzCiAgICAgYSBjb21wbGV0ZSBDSS9DRCB3\
b3JrZmxvdy4KICBkZXBlbmRlbmNpZXM6IFtdCiAgZG9jdW1lbnRhdGlvblVybDogImh0dHBzOi8v\
Z2l0aHViLmNvbS9udXhlby1zYW5kYm94L251eGVvLW9wZW5zaGlmdC9SRUFETUUubWQiCiAgaW1h\
Z2VVcmw6ICJodHRwczovL3d3dy5udXhlby5jb20vYXNzZXRzL2ltZ3MvbG9nbzM0MHg2MC5wbmci\
CnBsYW5zOgogIC0gbmFtZTogZGVmYXVsdAogICAgZGVzY3JpcHRpb246IERldmVsb3BtZW50IHdp\
dGggR2l0IFJlcG9zaXRvcnkKICAgIGZyZWU6IHRydWUKICAgIG1ldGFkYXRhOiB7fQogICAgcGFy\
YW1ldGVyczoKICAgICAgLSBuYW1lOiBwcm9qZWN0X25hbWUKICAgICAgICB0eXBlOiBzdHJpbmcK\
ICAgICAgICB0aXRsZTogUHJvamVjdCBOYW1lCiAgICAgICAgZGlzcGxheV9ncm91cDogUHJvamVj\
dCBwcm9wZXJ0aWVzCgogICAgICAtIG5hbWU6IHByb2plY3RfZ2l0X3JlcG8KICAgICAgICB0eXBl\
OiBzdHJpbmcKICAgICAgICB0aXRsZTogQWRkcmVzcyBvZiB0aGUgR2l0IFJlcG9zaXRvcnkKICAg\
ICAgICBkaXNwbGF5X2dyb3VwOiBQcm9qZWN0IHByb3BlcnRpZXMKCiAgICAgIC0gbmFtZTogcHJv\
amVjdF9naXRfcmVmCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGVmYXVsdDogIm1hc3Rl\
ciIKICAgICAgICB0aXRsZTogQnJhbmNoIG9mIHRoZSBHaXQgUmVwb3NpdG9yeQogICAgICAgIGRp\
c3BsYXlfZ3JvdXA6IFByb2plY3QgcHJvcGVydGllcwoKICAgICAgLSBuYW1lOiBwcm9qZWN0X2dp\
dF9zc2gKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogU1NIIGtleSBmb3IgZ2l0\
IHJlcG8gYWNjZXNzIGlmIG5lZWRlZAogICAgICAgIGRpc3BsYXlfdHlwZTogdGV4dGVhcmVhCiAg\
ICAgICAgZGlzcGxheV9ncm91cDogUHJvamVjdCBwcm9wZXJ0aWVzCgogICAgICAtIG5hbWU6IGRv\
bWFpbl9zdWZmaXgKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogRG9tYWluIHN1\
ZmZpeCBmb3Igcm91dGVzCiAgICAgICAgZGVmYXVsdDogYXBwcy5wcm9kLm51eGVvLmlvCiAgICAg\
ICAgZGlzcGxheV9ncm91cDogUHJvamVjdCBwcm9wZXJ0aWVzCgogICAgICAtIG5hbWU6IG51eGVv\
X2Nvbm5lY3RfdXNlcm5hbWUKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogfAog\
ICAgICAgICAgQSBOdXhlbyBDb25uZWN0IHVzZXJJZCB1c2VkIHRvIHJlZ2lzdGVyIHRoZSBpbnN0\
YW5jZSwgcHVsbAogICAgICAgICAgc3R1ZGlvIHByb2plY3QgZXRjLi4uCiAgICAgICAgZGlzcGxh\
eV9ncm91cDogQ29ubmVjdCBwcm9wZXJ0aWVzCgogICAgICAtIG5hbWU6IG51eGVvX2Nvbm5lY3Rf\
dG9rZW4KICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogfAogICAgICAgICAgQSB0\
b2tlbiBmb3IgdGhlIENvbm5lY3QgYWNjb3VudAogICAgICAgICAgKCBodHRwczovL2Nvbm5lY3Qu\
bnV4ZW8uY29tL251eGVvL3NpdGUvY29ubmVjdC90b2tlbnMgKQogICAgICAgIGRpc3BsYXlfdHlw\
ZTogcGFzc3dvcmQKICAgICAgICBkaXNwbGF5X2dyb3VwOiBDb25uZWN0IHByb3BlcnRpZXMKCiAg\
ICAgIC0gbmFtZTogbnV4ZW9fc3R1ZGlvX3Byb2plY3QKICAgICAgICB0eXBlOiBzdHJpbmcKICAg\
ICAgICB0aXRsZTogVGhlIG5hbWUgb2YgdGhlIHN0dWRpbyBwcm9qZWN0IHRvIHJlZ2lzdGVyIHRv\
CiAgICAgICAgZGlzcGxheV9ncm91cDogQ29ubmVjdCBwcm9wZXJ0aWVzCgogICAgICAtIG5hbWU6\
IGJhY2tlbmRfcmVwb3NpdG9yeV90eXBlCiAgICAgICAgZGVmYXVsdDogJ0RCUycKICAgICAgICB0\
eXBlOiBlbnVtCiAgICAgICAgZW51bTogWydEQlMnLCAnVkNTX1Bvc3RncmVzJ10KICAgICAgICB0\
aXRsZTogUmVwb3NpdG9yeSB0eXBlCiAgICAgICAgZGlzcGxheV9ncm91cDogQmFja2VuZCBzdG9y\
YWdlcwoKICAgICAgLSBuYW1lOiBiYWNrZW5kX3N0cmVhbV90eXBlCiAgICAgICAgZGVmYXVsdDog\
J0Nocm9uaWNsZScKICAgICAgICB0eXBlOiBlbnVtCiAgICAgICAgZW51bTogWydDaHJvbmljbGUn\
LCAnS2Fma2EnXQogICAgICAgIHRpdGxlOiBTdHJlYW0gdHlwZQogICAgICAgIGRpc3BsYXlfZ3Jv\
dXA6IEJhY2tlbmQgc3RvcmFnZXMKCiAgICAgIC0gbmFtZTogYmFja2VuZF9wdWJzdWJfdHlwZQog\
ICAgICAgIGRlZmF1bHQ6IGlubWVtb3J5CiAgICAgICAgdHlwZTogZW51bQogICAgICAgIGVudW06\
IFsnaW5tZW1vcnknLCAnc3RyZWFtJywgJ3JlZGlzJ10KICAgICAgICB0aXRsZTogU3RyZWFtIHR5\
cGUKICAgICAgICBkaXNwbGF5X2dyb3VwOiBCYWNrZW5kIHN0b3JhZ2VzCgogICAgICAtIG5hbWU6\
IGJhY2tlbmRfYmluYXJpZXNfdHlwZQogICAgICAgIGRlZmF1bHQ6IGZzCiAgICAgICAgdHlwZTog\
ZW51bQogICAgICAgIGVudW06IFsnZnMnLCAnbWluaW8nLCAnczMnXQogICAgICAgIHRpdGxlOiBC\
aW5hcmllcyBzdG9yYWdlIHR5cGUKICAgICAgICBkaXNwbGF5X2dyb3VwOiBCYWNrZW5kIHN0b3Jh\
Z2VzCgogICAgICAjIFRPRE86IEsvViBzdG9yZSB0eXBlCgogICAgICAtIG5hbWU6IGJhY2tlbmRf\
cHZfc3RvcmFnZV9jbGFzcwogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiBTdG9y\
YWdlIGNsYXNzIGZvciBiYWNrZW5kIHBlcnNpc3RlbmNlIHZvbHVtZXMKICAgICAgICBkZWZhdWx0\
OiBncDIKICAgICAgICBkaXNwbGF5X2dyb3VwOiBCYWNrZW5kIHN0b3JhZ2VzCgogICAgICAtIG5h\
bWU6IGJpbmFyaWVzX3B2X3N0b3JhZ2VfY2xhc3MKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
ICB0aXRsZTogU3RvcmFnZSBjbGFzcyBmb3IgYmFja2VuZCBwZXJzaXN0ZW5jZSB2b2x1bWVzIChp\
ZiBmcyB1c2VkKQogICAgICAgIGRlZmF1bHQ6IHNoYXJlZAogICAgICAgIGRpc3BsYXlfZ3JvdXA6\
IEJhY2tlbmQgc3RvcmFnZXMKCiAgLSBuYW1lOiBzdHVkaW8tb25seQogICAgZGVzY3JpcHRpb246\
IERldmVsb3BtZW50IHdpdGggU3R1ZGlvIHByb2plY3Qgb25seQogICAgZnJlZTogdHJ1ZQogICAg\
bWV0YWRhdGE6IHt9CiAgICBwYXJhbWV0ZXJzOgogICAgICAtIG5hbWU6IHByb2plY3RfbmFtZQog\
ICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiBQcm9qZWN0IE5hbWUKCiAgICAgIC0g\
bmFtZTogbnV4ZW9fY29ubmVjdF91c2VybmFtZQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAg\
IHRpdGxlOiB8CiAgICAgICAgICBBIE51eGVvIENvbm5lY3QgdXNlcklkIHVzZWQgdG8gcmVnaXN0\
ZXIgdGhlIGluc3RhbmNlLCBwdWxsCiAgICAgICAgICBzdHVkaW8gcHJvamVjdCBldGMuLi4KCiAg\
ICAgIC0gbmFtZTogbnV4ZW9fY29ubmVjdF90b2tlbgogICAgICAgIHR5cGU6IHN0cmluZwogICAg\
ICAgIHRpdGxlOiB8CiAgICAgICAgICBBIHRva2VuIGZvciB0aGUgQ29ubmVjdCBhY2NvdW50CiAg\
ICAgICAgICAoIGh0dHBzOi8vY29ubmVjdC5udXhlby5jb20vbnV4ZW8vc2l0ZS9jb25uZWN0L3Rv\
a2VucyApCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAoKICAgICAgLSBuYW1lOiBudXhl\
b19zdHVkaW9fcHJvamVjdAogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiBUaGUg\
bmFtZSBvZiB0aGUgc3R1ZGlvIHByb2plY3QgdG8gcmVnaXN0ZXIgdG8KCiAgICAgIC0gbmFtZTog\
bnV4ZW9fc3R1ZGlvX3ZlcnNpb24KICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTog\
VGhlIG5hbWUgb2YgdGhlIHN0dWRpbyBwcm9qZWN0IHRvIHJlZ2lzdGVyIHRvCgogICAgICAtIG5h\
bWU6IGRvbWFpbl9zdWZmaXgKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogRG9t\
YWluIHN1ZmZpeCBmb3Igcm91dGVzCiAgICAgICAgZGVmYXVsdDogYXBwcy5wcm9kLm51eGVvLmlv\
CgogICAgICAtIG5hbWU6IGJhY2tlbmRfcHZfc3RvcmFnZV9jbGFzcwogICAgICAgIHR5cGU6IHN0\
cmluZwogICAgICAgIHRpdGxlOiBTdG9yYWdlIGNsYXNzIGZvciBiYWNrZW5kIHBlcnNpc3RlbmNl\
IHZvbHVtZXMKICAgICAgICBkZWZhdWx0OiBncDIKCiAgICAgIC0gbmFtZTogYmluYXJpZXNfcHZf\
c3RvcmFnZV9jbGFzcwogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiBTdG9yYWdl\
IGNsYXNzIGZvciBiYWNrZW5kIHBlcnNpc3RlbmNlIHZvbHVtZXMKICAgICAgICBkZWZhdWx0OiBz\
aGFyZWQK"

ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-dev-apb

RUN chmod -R g=u /opt/{ansible,apb}

USER apb