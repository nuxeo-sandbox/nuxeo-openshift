FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBudXhlby1kZXYtYXBiCmRlc2NyaXB0aW9uOiBOdXhlbyBE\
ZXYgZW52aXJvbm1lbnQgd2l0aCBDSS9DRApiaW5kYWJsZTogZmFsc2UKYXN5bmM6IG9wdGlvbmFs\
CnRhZ3M6CiAgLSBudXhlbwptZXRhZGF0YToKICBkaXNwbGF5TmFtZTogTnV4ZW8gRGV2IGVudmly\
b25tZW50CiAgbG9uZ0Rlc2NyaXB0aW9uOgogICAgQSBmdWxsIGFuZCBtb2R1bGFyIE51eGVvIGRl\
dmVsb3BtZW50IGVudmlyb25tZW50IHRoYXQgYWxsb3dzCiAgICAgYSBjb21wbGV0ZSBDSS9DRCB3\
b3JrZmxvdy4KICBkZXBlbmRlbmNpZXM6IFtdCiAgZG9jdW1lbnRhdGlvblVybDogImh0dHBzOi8v\
Z2l0aHViLmNvbS9udXhlby1zYW5kYm94L251eGVvLW9wZW5zaGlmdC9SRUFETUUubWQiCiAgaW1h\
Z2VVcmw6ICJodHRwczovL3d3dy5udXhlby5jb20vYXNzZXRzL2ltZ3MvbG9nbzM0MHg2MC5wbmci\
CnBsYW5zOgogIC0gbmFtZTogZGVmYXVsdAogICAgZGVzY3JpcHRpb246IERldmVsb3BtZW50IHdp\
dGggR2l0IFJlcG9zaXRvcnkKICAgIGZyZWU6IHRydWUKICAgIG1ldGFkYXRhOiB7fQogICAgcGFy\
YW1ldGVyczoKICAgICAgLSBuYW1lOiBwcm9qZWN0X25hbWUKICAgICAgICB0eXBlOiBzdHJpbmcK\
ICAgICAgICB0aXRsZTogUHJvamVjdCBOYW1lCgogICAgICAtIG5hbWU6IHByb2plY3RfZ2l0X3Jl\
cG8KICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogQWRkcmVzcyBvZiB0aGUgR2l0\
IFJlcG9zaXRvcnkKCiAgICAgIC0gbmFtZTogcHJvamVjdF9naXRfcmVmCiAgICAgICAgdHlwZTog\
c3RyaW5nCiAgICAgICAgZGVmYXVsdDogIm1hc3RlciIKICAgICAgICB0aXRsZTogQnJhbmNoIG9m\
IHRoZSBHaXQgUmVwb3NpdG9yeQoKICAgICAgLSBuYW1lOiBwcm9qZWN0X2dpdF9zc2gKICAgICAg\
ICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogU1NIIGtleSBmb3IgZ2l0IHJlcG8gYWNjZXNz\
IGlmIG5lZWRlZAogICAgICAgIGRpc3BsYXlfdHlwZTogdGV4dGVhcmVhCgogICAgICAtIG5hbWU6\
IG51eGVvX2Nvbm5lY3RfdXNlcm5hbWUKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRs\
ZTogfAogICAgICAgICAgQSBOdXhlbyBDb25uZWN0IHVzZXJJZCB1c2VkIHRvIHJlZ2lzdGVyIHRo\
ZSBpbnN0YW5jZSwgcHVsbAogICAgICAgICAgc3R1ZGlvIHByb2plY3QgZXRjLi4uCgogICAgICAt\
IG5hbWU6IG51eGVvX2Nvbm5lY3RfdG9rZW4KICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0\
aXRsZTogfAogICAgICAgICAgQSB0b2tlbiBmb3IgdGhlIENvbm5lY3QgYWNjb3VudAogICAgICAg\
ICAgKCBodHRwczovL2Nvbm5lY3QubnV4ZW8uY29tL251eGVvL3NpdGUvY29ubmVjdC90b2tlbnMg\
KQogICAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKCiAgICAgIC0gbmFtZTogbnV4ZW9fc3R1\
ZGlvX3Byb2plY3QKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogVGhlIG5hbWUg\
b2YgdGhlIHN0dWRpbyBwcm9qZWN0IHRvIHJlZ2lzdGVyIHRvCgogICAgICAtIG5hbWU6IGRvbWFp\
bl9zdWZmaXgKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogRG9tYWluIHN1ZmZp\
eCBmb3Igcm91dGVzCiAgICAgICAgZGVmYXVsdDogYXBwcy5wcm9kLm51eGVvLmlvCgogICAgICAt\
IG5hbWU6IGJhY2tlbmRfcHZfc3RvcmFnZV9jbGFzcwogICAgICAgIHR5cGU6IHN0cmluZwogICAg\
ICAgIHRpdGxlOiBTdG9yYWdlIGNsYXNzIGZvciBiYWNrZW5kIHBlcnNpc3RlbmNlIHZvbHVtZXMK\
ICAgICAgICBkZWZhdWx0OiBncDIKCiAgICAgIC0gbmFtZTogYmluYXJpZXNfcHZfc3RvcmFnZV9j\
bGFzcwogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiBTdG9yYWdlIGNsYXNzIGZv\
ciBiYWNrZW5kIHBlcnNpc3RlbmNlIHZvbHVtZXMKICAgICAgICBkZWZhdWx0OiBzaGFyZWQKCiAg\
LSBuYW1lOiBzdHVkaW8tb25seQogICAgZGVzY3JpcHRpb246IERldmVsb3BtZW50IHdpdGggU3R1\
ZGlvIHByb2plY3Qgb25seQogICAgZnJlZTogdHJ1ZQogICAgbWV0YWRhdGE6IHt9CiAgICBwYXJh\
bWV0ZXJzOgogICAgICAtIG5hbWU6IHByb2plY3RfbmFtZQogICAgICAgIHR5cGU6IHN0cmluZwog\
ICAgICAgIHRpdGxlOiBQcm9qZWN0IE5hbWUKCiAgICAgIC0gbmFtZTogbnV4ZW9fY29ubmVjdF91\
c2VybmFtZQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiB8CiAgICAgICAgICBB\
IE51eGVvIENvbm5lY3QgdXNlcklkIHVzZWQgdG8gcmVnaXN0ZXIgdGhlIGluc3RhbmNlLCBwdWxs\
CiAgICAgICAgICBzdHVkaW8gcHJvamVjdCBldGMuLi4KCiAgICAgIC0gbmFtZTogbnV4ZW9fY29u\
bmVjdF90b2tlbgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiB8CiAgICAgICAg\
ICBBIHRva2VuIGZvciB0aGUgQ29ubmVjdCBhY2NvdW50CiAgICAgICAgICAoIGh0dHBzOi8vY29u\
bmVjdC5udXhlby5jb20vbnV4ZW8vc2l0ZS9jb25uZWN0L3Rva2VucyApCiAgICAgICAgZGlzcGxh\
eV90eXBlOiBwYXNzd29yZAoKICAgICAgLSBuYW1lOiBudXhlb19zdHVkaW9fcHJvamVjdAogICAg\
ICAgIHR5cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiBUaGUgbmFtZSBvZiB0aGUgc3R1ZGlvIHBy\
b2plY3QgdG8gcmVnaXN0ZXIgdG8KCiAgICAgIC0gbmFtZTogbnV4ZW9fc3R1ZGlvX3ZlcnNpb24K\
ICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogVGhlIG5hbWUgb2YgdGhlIHN0dWRp\
byBwcm9qZWN0IHRvIHJlZ2lzdGVyIHRvCgogICAgICAtIG5hbWU6IGRvbWFpbl9zdWZmaXgKICAg\
ICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogRG9tYWluIHN1ZmZpeCBmb3Igcm91dGVz\
CiAgICAgICAgZGVmYXVsdDogYXBwcy5wcm9kLm51eGVvLmlvCgogICAgICAtIG5hbWU6IGJhY2tl\
bmRfcHZfc3RvcmFnZV9jbGFzcwogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiBT\
dG9yYWdlIGNsYXNzIGZvciBiYWNrZW5kIHBlcnNpc3RlbmNlIHZvbHVtZXMKICAgICAgICBkZWZh\
dWx0OiBncDIKCiAgICAgIC0gbmFtZTogYmluYXJpZXNfcHZfc3RvcmFnZV9jbGFzcwogICAgICAg\
IHR5cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiBTdG9yYWdlIGNsYXNzIGZvciBiYWNrZW5kIHBl\
cnNpc3RlbmNlIHZvbHVtZXMKICAgICAgICBkZWZhdWx0OiBzaGFyZWQK"

ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-dev-apb

RUN chmod -R g=u /opt/{ansible,apb}

USER apb