FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG51eGVvLWRldi1hcGIKZGVzY3JpcHRpb246IE51eGVvIERldiBl\
bnZpcm9ubWVudCB3aXRoIENJL0NECmJpbmRhYmxlOiBGYWxzZQphc3luYzogb3B0aW9uYWwKdGFn\
czoKICAtIG51eGVvCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBOdXhlbyBEZXYgZW52aXJvbm1l\
bnQKICBsb25nRGVzY3JpcHRpb246CiAgICBBIGZ1bGwgYW5kIG1vZHVsYXIgTnV4ZW8gZGV2ZWxv\
cG1lbnQgZW52aXJvbm1lbnQgdGhhdCBhbGxvd3MKICAgICBhIGNvbXBsZXRlIENJL0NEIHdvcmtm\
bG93LgogIGRlcGVuZGVuY2llczogW10KICBkb2N1bWVudGF0aW9uVXJsOiAiaHR0cHM6Ly9naXRo\
dWIuY29tL251eGVvLXNhbmRib3gvbnV4ZW8tb3BlbnNoaWZ0L1JFQURNRS5tZCIKICBpbWFnZVVy\
bDogImh0dHBzOi8vd3d3Lm51eGVvLmNvbS9hc3NldHMvaW1ncy9sb2dvMzQweDYwLnBuZyIKcGxh\
bnM6CiAgLSBuYW1lOiBkZWZhdWx0CiAgICBkZXNjcmlwdGlvbjogRGV2ZWxvcG1lbnQgd2l0aCBH\
aXQgUmVwb3NpdG9yeQogICAgZnJlZTogVHJ1ZQogICAgbWV0YWRhdGE6IHt9CiAgICBwYXJhbWV0\
ZXJzOgogICAgICAtIG5hbWU6IHByb2plY3RfbmFtZQogICAgICAgIHR5cGU6IHN0cmluZwogICAg\
ICAgIHRpdGxlOiBQcm9qZWN0IE5hbWUKCiAgICAgIC0gbmFtZTogcHJvamVjdF9naXRfcmVwbwog\
ICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiBBZGRyZXNzIG9mIHRoZSBHaXQgUmVw\
b3NpdG9yeQoKICAgICAgLSBuYW1lOiBwcm9qZWN0X2dpdF9yZWYKICAgICAgICB0eXBlOiBzdHJp\
bmcKICAgICAgICBkZWZhdWx0OiAibWFzdGVyIgogICAgICAgIHRpdGxlOiBCcmFuY2ggb2YgdGhl\
IEdpdCBSZXBvc2l0b3J5CgogICAgICAtIG5hbWU6IHByb2plY3RfZ2l0X3NzaAogICAgICAgIHR5\
cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiBTU0gga2V5IGZvciBnaXQgcmVwbyBhY2Nlc3MgaWYg\
bmVlZGVkCiAgICAgICAgZGlzcGxheV90eXBlOiB0ZXh0ZWFyZWEKCiAgICAgIC0gbmFtZTogbnV4\
ZW9fY29ubmVjdF91c2VybmFtZQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiBB\
IE51eGVvIENvbm5lY3QgdXNlcklkIHVzZWQgdG8gcmVnaXN0ZXIgdGhlIGluc3RhbmNlLCBwdWxs\
IHN0dWRpbyBwcm9qZWN0IGV0Yy4uLgoKICAgICAgLSBuYW1lOiBudXhlb19jb25uZWN0X3Rva2Vu\
CiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgdGl0bGU6IEEgdG9rZW4gZm9yIHRoZSBDb25u\
ZWN0IGFjY291bnQgKCBodHRwczovL2Nvbm5lY3QubnV4ZW8uY29tL251eGVvL3NpdGUvY29ubmVj\
dC90b2tlbnMgKQogICAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKCiAgICAgIC0gbmFtZTog\
bnV4ZW9fc3R1ZGlvX3Byb2plY3QKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTog\
VGhlIG5hbWUgb2YgdGhlIHN0dWRpbyBwcm9qZWN0IHRvIHJlZ2lzdGVyIHRvCgogICAgICAtIG5h\
bWU6IGRvbWFpbl9zdWZmaXgKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogRG9t\
YWluIHN1ZmZpeCBmb3Igcm91dGVzCiAgICAgICAgZGVmYXVsdDogYXBwcy5wcm9kLm51eGVvLmlv\
CgogICAgICAtIG5hbWU6IGJhY2tlbmRfcHZfc3RvcmFnZV9jbGFzcwogICAgICAgIHR5cGU6IHN0\
cmluZwogICAgICAgIHRpdGxlOiBTdG9yYWdlIGNsYXNzIGZvciBiYWNrZW5kIHBlcnNpc3RlbmNl\
IHZvbHVtZXMKICAgICAgICBkZWZhdWx0OiBncDIKCiAgICAgIC0gbmFtZTogYmluYXJpZXNfcHZf\
c3RvcmFnZV9jbGFzcwogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiBTdG9yYWdl\
IGNsYXNzIGZvciBiYWNrZW5kIHBlcnNpc3RlbmNlIHZvbHVtZXMKICAgICAgICBkZWZhdWx0OiBz\
aGFyZWQKCiAgLSBuYW1lOiBzdHVkaW8tb25seQogICAgZGVzY3JpcHRpb246IERldmVsb3BtZW50\
IHdpdGggU3R1ZGlvIHByb2plY3Qgb25seQogICAgZnJlZTogVHJ1ZQogICAgbWV0YWRhdGE6IHt9\
CiAgICBwYXJhbWV0ZXJzOgogICAgICAtIG5hbWU6IHByb2plY3RfbmFtZQogICAgICAgIHR5cGU6\
IHN0cmluZwogICAgICAgIHRpdGxlOiBQcm9qZWN0IE5hbWUKCiAgICAgIC0gbmFtZTogbnV4ZW9f\
Y29ubmVjdF91c2VybmFtZQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiBBIE51\
eGVvIENvbm5lY3QgdXNlcklkIHVzZWQgdG8gcmVnaXN0ZXIgdGhlIGluc3RhbmNlLCBwdWxsIHN0\
dWRpbyBwcm9qZWN0IGV0Yy4uLgoKICAgICAgLSBuYW1lOiBudXhlb19jb25uZWN0X3Rva2VuCiAg\
ICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgdGl0bGU6IEEgdG9rZW4gZm9yIHRoZSBDb25uZWN0\
IGFjY291bnQgKCBodHRwczovL2Nvbm5lY3QubnV4ZW8uY29tL251eGVvL3NpdGUvY29ubmVjdC90\
b2tlbnMgKQogICAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKCiAgICAgIC0gbmFtZTogbnV4\
ZW9fc3R1ZGlvX3Byb2plY3QKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogVGhl\
IG5hbWUgb2YgdGhlIHN0dWRpbyBwcm9qZWN0IHRvIHJlZ2lzdGVyIHRvCgogICAgICAtIG5hbWU6\
IG51eGVvX3N0dWRpb192ZXJzaW9uCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgdGl0bGU6\
IFRoZSBuYW1lIG9mIHRoZSBzdHVkaW8gcHJvamVjdCB0byByZWdpc3RlciB0bwoKICAgICAgLSBu\
YW1lOiBkb21haW5fc3VmZml4CiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgdGl0bGU6IERv\
bWFpbiBzdWZmaXggZm9yIHJvdXRlcwogICAgICAgIGRlZmF1bHQ6IGFwcHMucHJvZC5udXhlby5p\
bwoKICAgICAgLSBuYW1lOiBiYWNrZW5kX3B2X3N0b3JhZ2VfY2xhc3MKICAgICAgICB0eXBlOiBz\
dHJpbmcKICAgICAgICB0aXRsZTogU3RvcmFnZSBjbGFzcyBmb3IgYmFja2VuZCBwZXJzaXN0ZW5j\
ZSB2b2x1bWVzCiAgICAgICAgZGVmYXVsdDogZ3AyCgogICAgICAtIG5hbWU6IGJpbmFyaWVzX3B2\
X3N0b3JhZ2VfY2xhc3MKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogU3RvcmFn\
ZSBjbGFzcyBmb3IgYmFja2VuZCBwZXJzaXN0ZW5jZSB2b2x1bWVzCiAgICAgICAgZGVmYXVsdDog\
c2hhcmVkCgoK"

ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-dev-apb

RUN chmod -R g=u /opt/{ansible,apb}

USER apb