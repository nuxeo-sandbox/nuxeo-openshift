FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBudXhlby1waXBlbGluZS1hcGIKZGVzY3JpcHRpb246IEpl\
bmtpbnMgcGlwZWxpbmUgZm9yIE51eGVvIENJL0NECmJpbmRhYmxlOiBmYWxzZQphc3luYzogb3B0\
aW9uYWwKdGFnczoKICAtIG51eGVvCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBKZW5raW5zIHBp\
cGVsaW5lIGZvciBOdXhlbwogIGxvbmdEZXNjcmlwdGlvbjoKICAgIEEgUGlwZWxpbmUgdGhhdCBk\
ZXBsb3kgYSBOdXhlbyBERVYgcHJvamVjdCBpbnRvIHNldmVyYWwgZW52aXJvbm1lbnRzCiAgZGVw\
ZW5kZW5jaWVzOiBbXQogIGRvY3VtZW50YXRpb25Vcmw6ICJodHRwczovL2dpdGh1Yi5jb20vbnV4\
ZW8vbnV4ZW8tb3BlbnNoaWZ0L1JFQURNRS5tZCIKICBpbWFnZVVybDogImh0dHBzOi8vd3d3Lm51\
eGVvLmNvbS9hc3NldHMvaW1ncy9sb2dvMzQweDYwLnBuZyIKcGxhbnM6CiAgLSBuYW1lOiBkZWZh\
dWx0CiAgICBkZXNjcmlwdGlvbjogRGV2ZWxvcG1lbnQgd2l0aCBHaXQgUmVwb3NpdG9yeQogICAg\
ZnJlZTogdHJ1ZQogICAgbWV0YWRhdGE6IHt9CiAgICBwYXJhbWV0ZXJzOgogICAgICAtIG5hbWU6\
IHByb2plY3RfbmFtZQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiBQcm9qZWN0\
IE5hbWUKICAgICAgICBkaXNwbGF5X2dyb3VwOiBQcm9qZWN0IHByb3BlcnRpZXMKICAgICAgLSBu\
YW1lOiBwaXBlbGluZV9uYW1lCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgdGl0bGU6IFBp\
cGVsaW5lIE5hbWUKICAgICAgICBkZWZhdWx0OiBkZWZhdWx0CiAgICAgICAgZGlzcGxheV9ncm91\
cDogUHJvamVjdCBwcm9wZXJ0aWVzCiAgICAgIC0gbmFtZTogcGlwZWxpbmVfZ2l0X3JlZgogICAg\
ICAgIHR5cGU6IHN0cmluZwogICAgICAgIHRpdGxlOiBHaXQgcmVmZXJlbmNlIGZvciB0aGF0IHBp\
cGVsaW5lIChvcHRpb25hbCkKICAgICAgICBkaXNwbGF5X2dyb3VwOiBQcm9qZWN0IHByb3BlcnRp\
ZXMKICAgICAgLSBuYW1lOiBwaXBlbGluZV9kZWZpbml0aW9uCiAgICAgICAgZGVmYXVsdDogJ3Vh\
dC1kZXYnCiAgICAgICAgdHlwZTogZW51bQogICAgICAgIGVudW06IFsndWF0LWRldicsJ3Npbmds\
ZSddCiAgICAgICAgdGl0bGU6IFBpcGVsaW5lIGRlZmluaXRpb24gdG8gdXNlCg=="


ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-pipeline-apb

RUN chmod -R g=u /opt/{ansible,apb}

USER apb