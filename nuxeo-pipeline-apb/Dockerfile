FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBudXhlby1waXBlbGluZS1hcGIKZGVzY3JpcHRpb246IEpl\
bmtpbnMgcGlwZWxpbmUgZm9yIE51eGVvIENJL0NECmJpbmRhYmxlOiBmYWxzZQphc3luYzogb3B0\
aW9uYWwKdGFnczoKICAtIG51eGVvCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBKZW5raW5zIHBp\
cGVsaW5lIGZvciBOdXhlbwogIGxvbmdEZXNjcmlwdGlvbjoKICAgIEEgUGlwZWxpbmUgdGhhdCBk\
ZXBsb3kgYSBOdXhlbyBERVYgcHJvamVjdCBpbnRvIHNldmVyYWwgZW52aXJvbm1lbnRzCiAgZGVw\
ZW5kZW5jaWVzOiBbXQogIGRvY3VtZW50YXRpb25Vcmw6ICJodHRwczovL2dpdGh1Yi5jb20vbnV4\
ZW8tc2FuZGJveC9udXhlby1vcGVuc2hpZnQvUkVBRE1FLm1kIgogIGltYWdlVXJsOiAiaHR0cHM6\
Ly93d3cubnV4ZW8uY29tL2Fzc2V0cy9pbWdzL2xvZ28zNDB4NjAucG5nIgpwbGFuczoKICAtIG5h\
bWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBEZXZlbG9wbWVudCB3aXRoIEdpdCBSZXBvc2l0\
b3J5CiAgICBmcmVlOiB0cnVlCiAgICBtZXRhZGF0YToge30KICAgIHBhcmFtZXRlcnM6CiAgICAg\
IC0gbmFtZTogcHJvamVjdF9uYW1lCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgdGl0bGU6\
IFByb2plY3QgTmFtZQogICAgICAgIGRpc3BsYXlfZ3JvdXA6IFByb2plY3QgcHJvcGVydGllcwog\
ICAgICAtIG5hbWU6IHBpcGVsaW5lX25hbWUKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0\
aXRsZTogUGlwZWxpbmUgTmFtZQogICAgICAgIGRlZmF1bHQ6IGRlZmF1bHQKICAgICAgICBkaXNw\
bGF5X2dyb3VwOiBQcm9qZWN0IHByb3BlcnRpZXMKICAgICAgLSBuYW1lOiBwaXBlbGluZV9naXRf\
cmVmCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgdGl0bGU6IEdpdCByZWZlcmVuY2UgZm9y\
IHRoYXQgcGlwZWxpbmUgKG9wdGlvbmFsKQogICAgICAgIGRpc3BsYXlfZ3JvdXA6IFByb2plY3Qg\
cHJvcGVydGllcwogICAgICAtIG5hbWU6IHBpcGVsaW5lX2RlZmluaXRpb24KICAgICAgICBkZWZh\
dWx0OiAndWF0LWRldicKICAgICAgICB0eXBlOiBlbnVtCiAgICAgICAgZW51bTogWyd1YXQtZGV2\
Jywnc2luZ2xlJ10KICAgICAgICB0aXRsZTogUGlwZWxpbmUgZGVmaW5pdGlvbiB0byB1c2UK"


ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-pipeline-apb

RUN chmod -R g=u /opt/{ansible,apb}

USER apb