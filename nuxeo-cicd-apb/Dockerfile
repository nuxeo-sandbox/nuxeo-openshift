FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG51eGVvLWNpY2QtYXBiCmRlc2NyaXB0aW9uOiBDSS9DRCBkZXBs\
b3ltZW50IGluIE9wZW5zaGlmdCBmb3IgTnV4ZW8KYmluZGFibGU6IGZhbHNlCmFzeW5jOiBvcHRp\
b25hbAp0YWdzOgogIC0gbnV4ZW8KICAtIGplbmtpbnMKbWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6\
IENJL0NEIGVudmlyb25tZW50IGZvciBOdXhlbyBEZXZlbG9wbWVudAogIGNvbnNvbGUub3BlbnNo\
aWZ0LmlvL2ljb25DbGFzczogaWNvbi1qZW5raW5zCiAgbG9uZ0Rlc2NyaXB0aW9uOgogICAgVGhp\
cyBiYXNpY2FsbHkgZGVwbG95cyBKZW5raW5zIGFuZCBOZXh1cwogIGRlcGVuZGVuY2llczogW10K\
ICBkb2N1bWVudGF0aW9uVXJsOiAiaHR0cHM6Ly9naXRodWIuY29tL251eGVvL251eGVvLW9wZW5z\
aGlmdC9SRUFETUUubWQiCiAgcHJvdmlkZXJEaXNwbGF5TmFtZTogIk51eGVvIgpwbGFuczoKICAt\
IG5hbWU6IGRlZmF1bHQKICAgIGRlc2NyaXB0aW9uOiBEZWZhdWx0IENJL0NEIGRlcGxveW1lbnQK\
ICAgIGZyZWU6IHRydWUKICAgIG1ldGFkYXRhOiB7fQogICAgcGFyYW1ldGVyczoKICAgIC0gbmFt\
ZTogcHJvamVjdF9uYW1lCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogUHJvamVjdCBO\
YW1lCiAgICAgIGRpc3BsYXlfZ3JvdXA6IFByb2plY3QgcHJvcGVydGllcwogICAgLSBuYW1lOiBk\
b21haW5fc3VmZml4CiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogRG9tYWluIHN1ZmZp\
eCBmb3Igcm91dGVzCiAgICAgIGRlZmF1bHQ6IGFwcHMucHJvZC5udXhlby5pbwogICAgICBkaXNw\
bGF5X2dyb3VwOiBQcm9qZWN0IHByb3BlcnRpZXMKCiAgICAtIG5hbWU6IG5leHVzX2FkbWluX3Vz\
ZXIKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIGRlZmF1bHQ6IGFkbWluCiAgICAgIHRpdGxlOiBB\
ZG1pbmlzdHJhdG9yIHVzZXIgbmFtZQogICAgICBkaXNwbGF5X2dyb3VwOiBOZXh1cyBjb25maWd1\
cmF0aW9uCiAgICAtIG5hbWU6IG5leHVzX2FkbWluX3Bhc3N3b3JkCiAgICAgIHR5cGU6IHN0cmlu\
ZwogICAgICB0aXRsZTogQWRtaW5pc3RyYXRvciB1c2VyIHBhc3N3b3JkIChnZW5lcmF0ZWQgaWYg\
bm9uZSBnaXZlbikKICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICBkaXNwbGF5X2dy\
b3VwOiBOZXh1cyBjb25maWd1cmF0aW9uCiAgICAtIG5hbWU6IG5leHVzX2FkbWluX2VtYWlsCiAg\
ICAgIHR5cGU6IHN0cmluZwogICAgICBkZWZhdWx0OiBkZXZudWxsQG51eGVvLmNvbQogICAgICB0\
aXRsZTogQWRtaW5pc3RyYXRvciBFbWFpbCBhZHJlc3MKICAgICAgZGlzcGxheV9ncm91cDogTmV4\
dXMgY29uZmlndXJhdGlvbgogICAgLSBuYW1lOiBuZXh1c19zdG9yYWdlX2NsYXNzCiAgICAgIHR5\
cGU6IHN0cmluZwogICAgICBkZWZhdWx0OiBzaGFyZWQKICAgICAgdGl0bGU6IE5leHVzIHN0b3Jh\
Z2UgY2xhc3MKICAgICAgZGlzcGxheV9ncm91cDogTmV4dXMgY29uZmlndXJhdGlvbgogICAgLSBu\
YW1lOiBuZXh1c19zdG9yYWdlX2NhcGFjaXR5CiAgICAgIHR5cGU6IHN0cmluZwogICAgICBkZWZh\
dWx0OiAyR2kKICAgICAgdGl0bGU6IE5leHVzIHN0b3JhZ2UgY2FwYWNpdHkKICAgICAgZGlzcGxh\
eV9ncm91cDogTmV4dXMgY29uZmlndXJhdGlvbgoKICAgIC0gbmFtZTogamVua2luc19naXRfcmVs\
ZWFzZV91c2VybmFtZQogICAgICB0eXBlOiBzdHJpbmcKICAgICAgZGVmYXVsdDogb3BlbnNoaWZ0\
CiAgICAgIHRpdGxlOiBHaXQgdXNlciBuYW1lIHRvIHBlcmZvcm0gcmVsZWFzZQogICAgICBkaXNw\
bGF5X2dyb3VwOiBKZW5raW5zIGNvbmZpZ3VyYXRpb24KICAgIC0gbmFtZTogamVua2luc19naXRf\
cmVsZWFzZV9lbWFpbAogICAgICB0eXBlOiBzdHJpbmcKICAgICAgZGVmYXVsdDogb3BlbnNoaWZ0\
QG51eGVvLmNvbQogICAgICB0aXRsZTogR2l0IHVzZXIgZW1haWwgdG8gcGVyZm9ybSByZWxlYXNl\
CiAgICAgIGRpc3BsYXlfZ3JvdXA6IEplbmtpbnMgY29uZmlndXJhdGlvbgogICAgLSBuYW1lOiBn\
aXRfc3NoX3NlY3JldF9uYW1lX292ZXJyaWRlCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRs\
ZTogTmFtZSBvZiB0aGUgc2VjcmV0IGNvbnRhaW5pbmcgdGhlIFNTSCBrZXkgdG8gYWNjZXNzIGdp\
dAogICAgICBkaXNwbGF5X2dyb3VwOiBKZW5raW5zIGNvbmZpZ3VyYXRpb24KCgo="


ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-cicd-apb/

RUN chmod -R g=u /opt/{ansible,apb}

USER apb