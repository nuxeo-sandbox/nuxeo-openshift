FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IG51eGVvLWNpY2QtYXBiCmRlc2NyaXB0aW9uOiBDSS9DRCBkZXBs\
b3ltZW50IGluIE9wZW5zaGlmdCBmb3IgTnV4ZW8KYmluZGFibGU6IGZhbHNlCmFzeW5jOiBvcHRp\
b25hbAp0YWdzOgogIC0gbnV4ZW8KICAtIGplbmtpbnMKbWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6\
IENJL0NEIGVudmlyb25tZW50IGZvciBOdXhlbyBEZXZlbG9wbWVudAogIGNvbnNvbGUub3BlbnNo\
aWZ0LmlvL2ljb25DbGFzczogaWNvbi1qZW5raW5zCiAgbG9uZ0Rlc2NyaXB0aW9uOgogICAgVGhp\
cyBiYXNpY2FsbHkgZGVwbG95cyBKZW5raW5zIGFuZCBOZXh1cwogIGRlcGVuZGVuY2llczogW10K\
ICBkb2N1bWVudGF0aW9uVXJsOiAiaHR0cHM6Ly9naXRodWIuY29tL251eGVvLXNhbmRib3gvbnV4\
ZW8tb3BlbnNoaWZ0L1JFQURNRS5tZCIKICBwcm92aWRlckRpc3BsYXlOYW1lOiAiTnV4ZW8iCnBs\
YW5zOgogIC0gbmFtZTogZGVmYXVsdAogICAgZGVzY3JpcHRpb246IERlZmF1bHQgQ0kvQ0QgZGVw\
bG95bWVudAogICAgZnJlZTogdHJ1ZQogICAgbWV0YWRhdGE6IHt9CiAgICBwYXJhbWV0ZXJzOgog\
ICAgLSBuYW1lOiBwcm9qZWN0X25hbWUKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBQ\
cm9qZWN0IE5hbWUKICAgICAgZGlzcGxheV9ncm91cDogUHJvamVjdCBwcm9wZXJ0aWVzCiAgICAt\
IG5hbWU6IGRvbWFpbl9zdWZmaXgKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiBEb21h\
aW4gc3VmZml4IGZvciByb3V0ZXMKICAgICAgZGVmYXVsdDogYXBwcy5wcm9kLm51eGVvLmlvCiAg\
ICAgIGRpc3BsYXlfZ3JvdXA6IFByb2plY3QgcHJvcGVydGllcwogICAgLSBuYW1lOiBuZXh1c19h\
ZG1pbl91c2VyCiAgICAgIHR5cGU6IHN0cmluZwogICAgICBkZWZhdWx0OiBhZG1pbgogICAgICB0\
aXRsZTogQWRtaW5pc3RyYXRvciB1c2VyIG5hbWUKICAgICAgZGlzcGxheV9ncm91cDogTmV4dXMg\
Y29uZmlndXJhdGlvbgogICAgLSBuYW1lOiBuZXh1c19hZG1pbl9wYXNzd29yZAogICAgICB0eXBl\
OiBzdHJpbmcKICAgICAgZGVmYXVsdDogYWRtaW4KICAgICAgdGl0bGU6IEFkbWluaXN0cmF0b3Ig\
dXNlciBwYXNzd29yZCAoZ2VuZXJhdGVkIGlmIG5vbmUgZ2l2ZW4pCiAgICAgIGRpc3BsYXlfdHlw\
ZTogcGFzc3dvcmQKICAgICAgZGlzcGxheV9ncm91cDogTmV4dXMgY29uZmlndXJhdGlvbgogICAg\
LSBuYW1lOiBuZXh1c19hZG1pbl9lbWFpbAogICAgICB0eXBlOiBzdHJpbmcKICAgICAgZGVmYXVs\
dDogZGV2bnVsbEBudXhlby5jb20KICAgICAgdGl0bGU6IEFkbWluaXN0cmF0b3IgRW1haWwgYWRy\
ZXNzCiAgICAgIGRpc3BsYXlfZ3JvdXA6IE5leHVzIGNvbmZpZ3VyYXRpb24KICAgIC0gbmFtZTog\
bmV4dXNfc3RvcmFnZV9jbGFzcwogICAgICB0eXBlOiBzdHJpbmcKICAgICAgZGVmYXVsdDogc2hh\
cmVkCiAgICAgIHRpdGxlOiBOZXh1cyBzdG9yYWdlIGNsYXNzCiAgICAgIGRpc3BsYXlfZ3JvdXA6\
IE5leHVzIGNvbmZpZ3VyYXRpb24KICAgIC0gbmFtZTogbmV4dXNfc3RvcmFnZV9jYXBhY2l0eQog\
ICAgICB0eXBlOiBzdHJpbmcKICAgICAgZGVmYXVsdDogMkdpCiAgICAgIHRpdGxlOiBOZXh1cyBz\
dG9yYWdlIGNhcGFjaXR5CiAgICAgIGRpc3BsYXlfZ3JvdXA6IE5leHVzIGNvbmZpZ3VyYXRpb24="


ADD playbooks /opt/apb/actions

# Add our role into the ansible roles dir
ADD . /opt/ansible/roles/nuxeo-cicd-apb/

RUN chmod -R g=u /opt/{ansible,apb}

USER apb